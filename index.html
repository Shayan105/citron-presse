<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio citron</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" href="favicon-32x32.png" sizes="32x32" type="image/png">
    <style>
        body {
            background-color: #F5FFE1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: Arial, sans-serif;
            margin: 0;
            overflow-x: hidden; /* Disallow horizontal scrolling */
        }
        .container {
            background: #2A2B29;
            padding: 20px;
            text-align: center;
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 50cm; /* Increased margin to add more space */
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
        }
        .date-selector {
            background: #D4FF4D;
            padding: 10px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            margin-top: 5px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2); /* Increased shadow */
            border: 2px solid #B3E044; /* Added stroke */
        }
        .album-art {
            width: 300px;
            height: 300px;
            background: url('lemon.jpg') center center / cover no-repeat;
            margin: 0 auto 20px auto;
            border-radius: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
        }
        button {
            background: #D4FF4D;
            border: none;
            font-size: 30px; /* Increased font size */
            cursor: pointer;
            color: #333;
            padding: 10px;
            border-radius: 50%;
            transition: background 0.3s, color 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 60px; /* Fixed width */
            height: 60px; /* Fixed height */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        button:active {
            background: #D4FF4D; /* Disable changing color on click */
            color: #333; /* Disable changing color on click */
        }
        button:hover {
            background: #B3E044;
            color: #000;
        }
        #seek-bar {
            width: 100%;
            max-width: 400px;
            height: 10px; /* Increased height */
            margin-top: 10px;
            -webkit-appearance: none;
            appearance: none;
            background: #ddd;
            border-radius: 5px;
            outline: none;
        }
        #seek-bar::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #D4FF4D;
            border: 2px solid #333; /* Added stroke */
            border-radius: 50%;
            cursor: pointer;
        }
        #seek-bar::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #D4FF4D;
            border: 2px solid #333; /* Added stroke */
            border-radius: 50%;
            cursor: pointer;
        }
        #date-picker {
            display: none;
        }
        .time-display {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 400px;
            margin-top: 10px;
            font-size: 14px;
            color: #fcd4d4;
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #333;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            display: none; /* Hidden by default */
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>

<div class="header">
    <img src="icon.png" alt="Logo" width="50">
    <div class="date-selector" id="date-selector">
        <span>&#128197;</span>
        <span id="selected-date">Date</span>
    </div>
    <input type="date" id="date-picker">
<br>
</div>

</head>
<body>



    <div class="container">

        <div class="album-art"></div>
        <p style="color:white;">Presse citron</p>

        <input type="range" id="seek-bar" min="0" max="100" value="0">
        <div class="time-display">
            <span id="elapsed-time">00:00</span>
            <span id="total-time">00:00</span>
        </div>
        <audio id="audio" src=""></audio>
        <div class="controls">
            <button id="prev"><i class="fas fa-backward"></i></button>
            <div style="position: relative;">
                <button id="play-pause"><i class="fas fa-play"></i></button>
            </div>
            <button id="next"><i class="fas fa-forward"></i></button>
        </div>
    </div>
    <div class="loading-spinner" id="loading-spinner"></div>
    <script>
        const audio = document.getElementById("audio");
        const playPauseButton = document.getElementById("play-pause");
        const seekBar = document.getElementById("seek-bar");
        const dateSelector = document.getElementById("date-selector");
        const datePicker = document.getElementById("date-picker");
        const selectedDate = document.getElementById("selected-date");
        const musicName = document.querySelector("p");
        const prevButton = document.getElementById("prev");
        const nextButton = document.getElementById("next");
        const elapsedTime = document.getElementById("elapsed-time");
        const totalTime = document.getElementById("total-time");
        const loadingSpinner = document.getElementById("loading-spinner");

        playPauseButton.addEventListener("click", () => {
            if (audio.paused) {
                audio.play();
                playPauseButton.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                audio.pause();
                playPauseButton.innerHTML = '<i class="fas fa-play"></i>';
            }
        });

        audio.addEventListener("timeupdate", () => {
            seekBar.value = (audio.currentTime / audio.duration) * 100;
            elapsedTime.textContent = formatTime(audio.currentTime);
        });

        audio.addEventListener("loadedmetadata", () => {
            totalTime.textContent = formatTime(audio.duration);
        });

        seekBar.addEventListener("input", () => {
            audio.currentTime = (seekBar.value / 100) * audio.duration;
        });

        dateSelector.addEventListener("click", () => {
            datePicker.showPicker();
        });

        datePicker.addEventListener("change", () => {
            updateAudioSource(new Date(datePicker.value));
        });

        prevButton.addEventListener("click", () => {
            const currentDate = new Date(datePicker.value);
            currentDate.setDate(currentDate.getDate() - 1);
            updateAudioSource(currentDate);
        });

        nextButton.addEventListener("click", () => {
            const currentDate = new Date(datePicker.value);
            currentDate.setDate(currentDate.getDate() + 1);
            updateAudioSource(currentDate);
        });

        function updateAudioSource(date) {
            const formattedDate = `${String(date.getDate()).padStart(2, '0')}-${String(date.getMonth() + 1).padStart(2, '0')}-${date.getFullYear()}`;
            selectedDate.textContent = formattedDate;
            datePicker.value = date.toISOString().split('T')[0];

            // Show loading spinner and update time codes
            loadingSpinner.style.display = 'block';
            playPauseButton.style.display = 'none';
            elapsedTime.textContent = "-";
            totalTime.textContent = "-";

            // Send GET request and update audio source with cache-busting
            const cacheBuster = new Date().getTime();
            fetch(`${formattedDate}.mp3?cb=${cacheBuster}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.blob();
                })
                .then(blob => {
                    const url = URL.createObjectURL(blob);
                    audio.src = url;
                    audio.load(); // Load the new audio source
                    musicName.textContent = "Presse citron";
                    seekBar.value = 0; // Reset the seek bar
                    elapsedTime.textContent = "00:00"; // Reset elapsed time
                    totalTime.textContent = "00:00"; // Reset total time

                    // Update the time codes and seek bar after the audio metadata is loaded
                    audio.addEventListener("loadedmetadata", () => {
                        totalTime.textContent = formatTime(audio.duration);
                        seekBar.value = 0;
                        elapsedTime.textContent = "00:00";
                    
                        playPauseButton.innerHTML = '<i class="fas fa-pause"></i>';
                        // Hide loading spinner
                        loadingSpinner.style.display = 'none';
                        playPauseButton.style.display = 'flex';
                    });
                })
                .catch(error => {
                    console.error('There has been a problem with your fetch operation:', error);
                    musicName.textContent = "Non dispo :(";
                    // Hide loading spinner
                    loadingSpinner.style.display = 'none';
                    playPauseButton.style.display = 'flex';
                });
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        // Set the default date to today's date and fetch the audio
        const today = new Date();
        datePicker.value = today.toISOString().split('T')[0];
        updateAudioSource(today);
    </script>

<style>
    .raindrop {
        position: fixed;
        top: -2em;
        font-size: 20px;
        color: rgba(0, 0, 0, 0.1);
        animation: fall linear infinite;
        pointer-events: none;
    }

    @keyframes fall {
        to {
            transform: translateY(100vh);
        }
    }
</style>

<script>
const lemonImage = new Image();

// Check if the image is already in localStorage
let cachedImage = localStorage.getItem('cachedLemonImage');

if (!cachedImage) {
    // If not cached, load the image and store it in localStorage
    lemonImage.src = 'tinyLemon.png'; // Path to your image
    lemonImage.onload = () => {
        console.log('Image loaded and cached');
        
        // Convert image to Base64 after it's loaded
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = lemonImage.width;
        canvas.height = lemonImage.height;
        ctx.drawImage(lemonImage, 0, 0);

        // Save the image as Base64 to localStorage
        cachedImage = canvas.toDataURL();
        localStorage.setItem('cachedLemonImage', cachedImage);
    };
} else {
    // If cached, set the src to the Base64 encoded version
    lemonImage.src = cachedImage;
}

// Function to create the raindrop effect
function createRaindrop() {
    const drop = document.createElement('img');
    drop.classList.add('raindrop');
    
    // Use the cached Base64 image as the source
    drop.src = cachedImage;
    drop.style.left = Math.random() * 100 + 'vw';  // Random horizontal position
    const size = Math.random() * 20 + 20;  // Random size between 20px and 40px
    drop.style.width = `${size}px`;
    drop.style.height = 'auto';  // Keep the aspect ratio
    drop.style.animationDuration = (Math.random() * 2 + 3) + 's';  // Random fall duration
    document.body.appendChild(drop);

    // Remove the raindrop after 5 seconds
    setTimeout(() => {
        drop.remove();
    }, 5000);
}

// Call createRaindrop every second
setInterval(createRaindrop, 1000);

</script>


</body>
</html>
